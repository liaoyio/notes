import{f as J,a as K,b as O,g as Z,n as Q,s as W,d as X}from"./chunks/noMoreClick.7cca1d1a.js";import{f as T,a4 as j,r as E,c as Y,D as y,h as v,i as D,G as f,B as g,k as U,u as z,t as G,C as q,A as x,a1 as V,z as $,ag as k,_ as ee,o as te,a5 as re,F as ne}from"./chunks/framework.1a1d6641.js";import{u as ae}from"./chunks/index.8dd3f9f1.js";import{g as oe}from"./chunks/commonjsHelpers.725317a4.js";var H={exports:{}};(function(P,A){(function(i){P.exports=i()})(function(i){var w=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function d(o,a){var t=o[0],e=o[1],n=o[2],r=o[3];t+=(e&n|~e&r)+a[0]-680876936|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&n)+a[1]-389564586|0,r=(r<<12|r>>>20)+t|0,n+=(r&t|~r&e)+a[2]+606105819|0,n=(n<<17|n>>>15)+r|0,e+=(n&r|~n&t)+a[3]-1044525330|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&r)+a[4]-176418897|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&n)+a[5]+1200080426|0,r=(r<<12|r>>>20)+t|0,n+=(r&t|~r&e)+a[6]-1473231341|0,n=(n<<17|n>>>15)+r|0,e+=(n&r|~n&t)+a[7]-45705983|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&r)+a[8]+1770035416|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&n)+a[9]-1958414417|0,r=(r<<12|r>>>20)+t|0,n+=(r&t|~r&e)+a[10]-42063|0,n=(n<<17|n>>>15)+r|0,e+=(n&r|~n&t)+a[11]-1990404162|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&r)+a[12]+1804603682|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&n)+a[13]-40341101|0,r=(r<<12|r>>>20)+t|0,n+=(r&t|~r&e)+a[14]-1502002290|0,n=(n<<17|n>>>15)+r|0,e+=(n&r|~n&t)+a[15]+1236535329|0,e=(e<<22|e>>>10)+n|0,t+=(e&r|n&~r)+a[1]-165796510|0,t=(t<<5|t>>>27)+e|0,r+=(t&n|e&~n)+a[6]-1069501632|0,r=(r<<9|r>>>23)+t|0,n+=(r&e|t&~e)+a[11]+643717713|0,n=(n<<14|n>>>18)+r|0,e+=(n&t|r&~t)+a[0]-373897302|0,e=(e<<20|e>>>12)+n|0,t+=(e&r|n&~r)+a[5]-701558691|0,t=(t<<5|t>>>27)+e|0,r+=(t&n|e&~n)+a[10]+38016083|0,r=(r<<9|r>>>23)+t|0,n+=(r&e|t&~e)+a[15]-660478335|0,n=(n<<14|n>>>18)+r|0,e+=(n&t|r&~t)+a[4]-405537848|0,e=(e<<20|e>>>12)+n|0,t+=(e&r|n&~r)+a[9]+568446438|0,t=(t<<5|t>>>27)+e|0,r+=(t&n|e&~n)+a[14]-1019803690|0,r=(r<<9|r>>>23)+t|0,n+=(r&e|t&~e)+a[3]-187363961|0,n=(n<<14|n>>>18)+r|0,e+=(n&t|r&~t)+a[8]+1163531501|0,e=(e<<20|e>>>12)+n|0,t+=(e&r|n&~r)+a[13]-1444681467|0,t=(t<<5|t>>>27)+e|0,r+=(t&n|e&~n)+a[2]-51403784|0,r=(r<<9|r>>>23)+t|0,n+=(r&e|t&~e)+a[7]+1735328473|0,n=(n<<14|n>>>18)+r|0,e+=(n&t|r&~t)+a[12]-1926607734|0,e=(e<<20|e>>>12)+n|0,t+=(e^n^r)+a[5]-378558|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^n)+a[8]-2022574463|0,r=(r<<11|r>>>21)+t|0,n+=(r^t^e)+a[11]+1839030562|0,n=(n<<16|n>>>16)+r|0,e+=(n^r^t)+a[14]-35309556|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^r)+a[1]-1530992060|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^n)+a[4]+1272893353|0,r=(r<<11|r>>>21)+t|0,n+=(r^t^e)+a[7]-155497632|0,n=(n<<16|n>>>16)+r|0,e+=(n^r^t)+a[10]-1094730640|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^r)+a[13]+681279174|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^n)+a[0]-358537222|0,r=(r<<11|r>>>21)+t|0,n+=(r^t^e)+a[3]-722521979|0,n=(n<<16|n>>>16)+r|0,e+=(n^r^t)+a[6]+76029189|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^r)+a[9]-640364487|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^n)+a[12]-421815835|0,r=(r<<11|r>>>21)+t|0,n+=(r^t^e)+a[15]+530742520|0,n=(n<<16|n>>>16)+r|0,e+=(n^r^t)+a[2]-995338651|0,e=(e<<23|e>>>9)+n|0,t+=(n^(e|~r))+a[0]-198630844|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~n))+a[7]+1126891415|0,r=(r<<10|r>>>22)+t|0,n+=(t^(r|~e))+a[14]-1416354905|0,n=(n<<15|n>>>17)+r|0,e+=(r^(n|~t))+a[5]-57434055|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~r))+a[12]+1700485571|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~n))+a[3]-1894986606|0,r=(r<<10|r>>>22)+t|0,n+=(t^(r|~e))+a[10]-1051523|0,n=(n<<15|n>>>17)+r|0,e+=(r^(n|~t))+a[1]-2054922799|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~r))+a[8]+1873313359|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~n))+a[15]-30611744|0,r=(r<<10|r>>>22)+t|0,n+=(t^(r|~e))+a[6]-1560198380|0,n=(n<<15|n>>>17)+r|0,e+=(r^(n|~t))+a[13]+1309151649|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~r))+a[4]-145523070|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~n))+a[11]-1120210379|0,r=(r<<10|r>>>22)+t|0,n+=(t^(r|~e))+a[2]+718787259|0,n=(n<<15|n>>>17)+r|0,e+=(r^(n|~t))+a[9]-343485551|0,e=(e<<21|e>>>11)+n|0,o[0]=t+o[0]|0,o[1]=e+o[1]|0,o[2]=n+o[2]|0,o[3]=r+o[3]|0}function C(o){var a=[],t;for(t=0;t<64;t+=4)a[t>>2]=o.charCodeAt(t)+(o.charCodeAt(t+1)<<8)+(o.charCodeAt(t+2)<<16)+(o.charCodeAt(t+3)<<24);return a}function N(o){var a=[],t;for(t=0;t<64;t+=4)a[t>>2]=o[t]+(o[t+1]<<8)+(o[t+2]<<16)+(o[t+3]<<24);return a}function B(o){var a=o.length,t=[1732584193,-271733879,-1732584194,271733878],e,n,r,l,b,S;for(e=64;e<=a;e+=64)d(t,C(o.substring(e-64,e)));for(o=o.substring(e-64),n=o.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)r[e>>2]|=o.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(d(t,r),e=0;e<16;e+=1)r[e]=0;return l=a*8,l=l.toString(16).match(/(.*?)(.{0,8})$/),b=parseInt(l[2],16),S=parseInt(l[1],16)||0,r[14]=b,r[15]=S,d(t,r),t}function F(o){var a=o.length,t=[1732584193,-271733879,-1732584194,271733878],e,n,r,l,b,S;for(e=64;e<=a;e+=64)d(t,N(o.subarray(e-64,e)));for(o=e-64<a?o.subarray(e-64):new Uint8Array(0),n=o.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)r[e>>2]|=o[e]<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(d(t,r),e=0;e<16;e+=1)r[e]=0;return l=a*8,l=l.toString(16).match(/(.*?)(.{0,8})$/),b=parseInt(l[2],16),S=parseInt(l[1],16)||0,r[14]=b,r[15]=S,d(t,r),t}function M(o){var a="",t;for(t=0;t<4;t+=1)a+=w[o>>t*8+4&15]+w[o>>t*8&15];return a}function m(o){var a;for(a=0;a<o.length;a+=1)o[a]=M(o[a]);return o.join("")}m(B("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function o(a,t){return a=a|0||0,a<0?Math.max(a+t,0):Math.min(a,t)}ArrayBuffer.prototype.slice=function(a,t){var e=this.byteLength,n=o(a,e),r=e,l,b,S,L;return t!==i&&(r=o(t,e)),n>r?new ArrayBuffer(0):(l=r-n,b=new ArrayBuffer(l),S=new Uint8Array(b),L=new Uint8Array(this,n,l),S.set(L),b)}}();function s(o){return/[\u0080-\uFFFF]/.test(o)&&(o=unescape(encodeURIComponent(o))),o}function c(o,a){var t=o.length,e=new ArrayBuffer(t),n=new Uint8Array(e),r;for(r=0;r<t;r+=1)n[r]=o.charCodeAt(r);return a?n:e}function p(o){return String.fromCharCode.apply(null,new Uint8Array(o))}function _(o,a,t){var e=new Uint8Array(o.byteLength+a.byteLength);return e.set(new Uint8Array(o)),e.set(new Uint8Array(a),o.byteLength),t?e:e.buffer}function h(o){var a=[],t=o.length,e;for(e=0;e<t-1;e+=2)a.push(parseInt(o.substr(e,2),16));return String.fromCharCode.apply(String,a)}function u(){this.reset()}return u.prototype.append=function(o){return this.appendBinary(s(o)),this},u.prototype.appendBinary=function(o){this._buff+=o,this._length+=o.length;var a=this._buff.length,t;for(t=64;t<=a;t+=64)d(this._hash,C(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},u.prototype.end=function(o){var a=this._buff,t=a.length,e,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r;for(e=0;e<t;e+=1)n[e>>2]|=a.charCodeAt(e)<<(e%4<<3);return this._finish(n,t),r=m(this._hash),o&&(r=h(r)),this.reset(),r},u.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},u.prototype.setState=function(o){return this._buff=o.buff,this._length=o.length,this._hash=o.hash,this},u.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},u.prototype._finish=function(o,a){var t=a,e,n,r;if(o[t>>2]|=128<<(t%4<<3),t>55)for(d(this._hash,o),t=0;t<16;t+=1)o[t]=0;e=this._length*8,e=e.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(e[2],16),r=parseInt(e[1],16)||0,o[14]=n,o[15]=r,d(this._hash,o)},u.hash=function(o,a){return u.hashBinary(s(o),a)},u.hashBinary=function(o,a){var t=B(o),e=m(t);return a?h(e):e},u.ArrayBuffer=function(){this.reset()},u.ArrayBuffer.prototype.append=function(o){var a=_(this._buff.buffer,o,!0),t=a.length,e;for(this._length+=o.byteLength,e=64;e<=t;e+=64)d(this._hash,N(a.subarray(e-64,e)));return this._buff=e-64<t?new Uint8Array(a.buffer.slice(e-64)):new Uint8Array(0),this},u.ArrayBuffer.prototype.end=function(o){var a=this._buff,t=a.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n,r;for(n=0;n<t;n+=1)e[n>>2]|=a[n]<<(n%4<<3);return this._finish(e,t),r=m(this._hash),o&&(r=h(r)),this.reset(),r},u.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.ArrayBuffer.prototype.getState=function(){var o=u.prototype.getState.call(this);return o.buff=p(o.buff),o},u.ArrayBuffer.prototype.setState=function(o){return o.buff=c(o.buff,!0),u.prototype.setState.call(this,o)},u.ArrayBuffer.prototype.destroy=u.prototype.destroy,u.ArrayBuffer.prototype._finish=u.prototype._finish,u.ArrayBuffer.hash=function(o,a){var t=F(new Uint8Array(o)),e=m(t);return a?h(e):e},u})})(H);var ie=H.exports;const le=oe(ie),se={class:"el"},ue={key:0},I=1024*1024*2,fe=T({__name:"FileFragUpload",emits:["refresh"],setup(P,{emit:A}){const i=j({currentStage:"a",dictStage:{a:"等待选择文件",b:"文件扫描中",c:"文件上传中",d:"文件上传完成"},chunkNum:0,chunkTotal:0,fileMd5:"",fileSize:0}),w=E(),d=Y(()=>!["a","d"].includes(i.currentStage)),C=()=>{w.value.click()},N=async s=>{i.currentStage="b";const c=s.target.files[0];i.chunkTotal=Math.ceil(c.size/I);const p=B(c);i.fileMd5=await F(p),w.value.value="";const _=await J({fileName:c.name,fileMd5:i.fileMd5,fileSize:i.fileSize,chunkNum:i.chunkTotal});if(typeof _.data=="string"){m();return}i.currentStage="c",await M(_.data.currentChunkNum,p),i.currentStage="d",await K({fileMd5:i.fileMd5}),m()};function B(s){const c=[];for(let p=0;p<s.size;p+=I)c.push(s.slice(p,p+I));return c}function F(s){return new Promise(c=>{i.fileSize=0;const p=new le,_=h=>{if(h>=s.length){i.chunkNum=0,c(p.end());return}const u=s[h];i.chunkNum=h+1,i.fileSize+=u.size;const o=new FileReader;o.onload=a=>{const t=a.target.result;p.append(t),_(h+1)},o.readAsArrayBuffer(u)};_(0)})}function M(s,c){return new Promise(p=>{const _=h=>{if(h>c.length){p(null);return}i.chunkNum=h;const u=c[h-1],o=new FormData;o.append("file",u);const a={fileMd5:i.fileMd5,orderNum:h,file:o};O(a).then(()=>{_(h+1)})};_(s)})}function m(){i.currentStage="d",i.chunkNum=0,A("refresh")}return(s,c)=>{const p=y("el-button"),_=y("el-progress");return v(),D("div",se,[f(p,{disabled:d.value,type:"primary",icon:z(ae),onClick:C},{default:g(()=>[U(" 上传文件 ")]),_:1},8,["disabled","icon"]),d.value?(v(),D("span",ue,G(`${i.dictStage[i.currentStage]}`),1)):q("",!0),d.value?(v(),x(_,{key:1,style:{width:"300px"},percentage:Number((i.chunkNum/i.chunkTotal*100).toFixed(2)),"stroke-width":15,striped:"","striped-flow":""},null,8,["percentage"])):q("",!0),V($("input",{ref_key:"inp",ref:w,type:"file",onChange:N},null,544),[[k,!1]])])}}});const pe=ee(fe,[["__scopeId","data-v-558f4575"]]),de={class:"max-w-5xl mx-auto py-20"},ce={class:"flex flex-row-reverse mt-3"},R="http://124.222.108.118:8075/ufile/",he=T({__name:"FileFrag",setup(P){const A=Q,i=j({list:[],total:0,loaded:!1,queryParams:{pageNum:1,pageSize:10,fileName:"",fileMd5:"",ignoreSame:!1,orderByDto:[{num:0,field:"createTime",isAsc:!1}]},downloadProgress:0,dialogVisible:!1}),w=E(),d=()=>{i.loaded=!1,W(i.queryParams).then(m=>{i.list=m.rows,i.total=m.total,i.loaded=!0})};te(()=>d());const C=({_:m,prop:s,order:c})=>{c?i.queryParams.orderByDto=[{num:0,field:s,isAsc:c==="ascending"}]:i.queryParams.orderByDto.splice(i.queryParams.orderByDto.findIndex(p=>p.field===s),1),d()},N=m=>{i.dialogVisible=!0,X(R+m.fileNewName,m.fileName,s=>{i.downloadProgress=Number((s.progress*100).toFixed(2)),s.progress===1&&(i.dialogVisible=!1,i.downloadProgress=0)})},B=m=>{window&&window.open(`${R}${m.fileNewName}`)},F=()=>{d()},M=()=>{w.value&&(w.value.resetFields(),d())};return(m,s)=>{const c=y("el-input"),p=y("el-form-item"),_=y("el-switch"),h=y("el-button"),u=y("el-form"),o=y("el-table-column"),a=y("el-table"),t=y("el-pagination"),e=y("el-progress"),n=y("el-dialog"),r=re("loading");return v(),D(ne,null,[$("div",de,[f(pe,{onRefresh:d}),f(u,{ref_key:"formRef",ref:w,class:"mt-4",inline:!0,model:i.queryParams},{default:g(()=>[f(p,{label:"源文件名",prop:"fileName"},{default:g(()=>[f(c,{modelValue:i.queryParams.fileName,"onUpdate:modelValue":s[0]||(s[0]=l=>i.queryParams.fileName=l),placeholder:"请输入源文件名",clearable:""},null,8,["modelValue"])]),_:1}),f(p,{label:"文件MD5",prop:"fileMd5"},{default:g(()=>[f(c,{modelValue:i.queryParams.fileMd5,"onUpdate:modelValue":s[1]||(s[1]=l=>i.queryParams.fileMd5=l),placeholder:"请输入文件MD5",clearable:""},null,8,["modelValue"])]),_:1}),f(p,{label:"忽略重复文件",prop:"ignoreSame"},{default:g(()=>[f(_,{modelValue:i.queryParams.ignoreSame,"onUpdate:modelValue":s[2]||(s[2]=l=>i.queryParams.ignoreSame=l)},null,8,["modelValue"])]),_:1}),f(p,null,{default:g(()=>[f(h,{type:"primary",onClick:F},{default:g(()=>[U(" 搜索 🔍 ")]),_:1}),f(h,{onClick:M},{default:g(()=>[U(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"]),V((v(),x(a,{style:{width:"100%"},data:i.list,stripe:"",onSortChange:C},{default:g(()=>[f(o,{prop:"id",label:"ID",width:"180"}),f(o,{prop:"fileName",label:"源文件名","min-width":"200"}),f(o,{prop:"fileNewName",label:"现文件名","min-width":"220"}),f(o,{prop:"fileMd5",label:"文件MD5","min-width":"300"}),f(o,{prop:"fileSize",label:"文件大小",width:"100"},{default:g(({row:l})=>[U(G(z(Z)(l.fileSize)),1)]),_:1}),f(o,{prop:"chunkNum",label:"分片总数",width:"80"}),f(o,{prop:"uploadedNum",label:"已上传分片数","min-width":"120"}),f(o,{prop:"remark",label:"备注",width:"150"}),f(o,{prop:"whetherFirst",sortable:"custom",label:"第一上传人",width:"120"}),f(o,{prop:"whetherMerge",sortable:"custom",label:"是否已合并",width:"120"}),f(o,{prop:"createBy",label:"Create By",width:"100"}),f(o,{prop:"createTime",sortable:"custom",label:"上传日期",width:"200"}),f(o,{fixed:"right",label:"操作","min-width":"120"},{default:g(({row:l})=>[l.chunkNum===l.uploadedNum?V((v(),x(h,{key:0,link:"",type:"primary",size:"small",onClick:b=>B(l)},{default:g(()=>[U(" 在线观看 ")]),_:2},1032,["onClick"])),[[z(A)]]):q("",!0),l.chunkNum===l.uploadedNum?V((v(),x(h,{key:1,link:"",type:"primary",size:"small",onClick:b=>N(l)},{default:g(()=>[U(" 下载 ")]),_:2},1032,["onClick"])),[[z(A)]]):q("",!0)]),_:1})]),_:1},8,["data"])),[[r,!i.loaded]]),$("div",ce,[f(t,{"current-page":i.queryParams.pageNum,"onUpdate:currentPage":s[3]||(s[3]=l=>i.queryParams.pageNum=l),"page-size":i.queryParams.pageSize,"onUpdate:pageSize":s[4]||(s[4]=l=>i.queryParams.pageSize=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:i.total,onSizeChange:d,onCurrentChange:d},null,8,["current-page","page-size","total"])])]),f(n,{modelValue:i.dialogVisible,"onUpdate:modelValue":s[5]||(s[5]=l=>i.dialogVisible=l),draggable:"","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{default:g(()=>[f(e,{percentage:i.downloadProgress,"stroke-width":15,striped:"","striped-flow":"",duration:10},null,8,["percentage"])]),_:1},8,["modelValue"])],64)}}}),we=JSON.parse('{"title":"完整文件上传","description":"文件分片上传、断点续传、上传进度条、视频在线预览、文件下载进度条","frontmatter":{"layout":false,"title":"完整文件上传","description":"文件分片上传、断点续传、上传进度条、视频在线预览、文件下载进度条"},"headers":[],"relativePath":"pages/upload-frag.md","lastUpdated":1696236510000}'),me={name:"pages/upload-frag.md"},Se=T({...me,setup(P){return(A,i)=>(v(),D("div",null,[f(he)]))}});export{we as __pageData,Se as default};
